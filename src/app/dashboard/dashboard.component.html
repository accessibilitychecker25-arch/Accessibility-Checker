<app-file-upload (submitted)="handleFile($event)"></app-file-upload>

<!-- Progress bar -->
<div class="mt-4 w-full max-w-md" *ngIf="isUploading">
  <div class="text-sm text-gray-600 dark:text-gray-300 mb-1">
    Uploading: {{ progress }}%
  </div>
  <div class="w-full bg-gray-200 dark:bg-gray-700 h-2 rounded">
    <div
      class="h-2 bg-blue-600 dark:bg-blue-500 rounded transition-all"
      [style.width.%]="progress"
    ></div>
  </div>
</div>

<!-- JSON Results -->
<div class="mt-6 w-full" *ngIf="reportResult">
  <div class="w-full p-4 bg-gray-100 dark:bg-gray-800 rounded shadow">
    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2">
      Accessibility Report ({{ reportResult.fileName }})
    </h3>

    <!-- Backend Filename Validation Errors -->
    <div *ngIf="reportResult.isFilenameError" class="mb-4 p-4 bg-red-50 border border-red-200 rounded">
      <h4 class="text-red-800 font-medium mb-2">ðŸš« Filename Accessibility Issues</h4>
      <p class="text-red-700 text-sm mb-3">{{ reportResult.apiMessage }}</p>
      
      <div *ngIf="reportResult.errorDetails?.errors?.length" class="mb-3">
        <h5 class="text-red-700 font-medium text-sm mb-1">Errors:</h5>
        <ul class="list-disc list-inside text-red-600 text-xs space-y-1">
          <li *ngFor="let error of reportResult.errorDetails.errors">{{ error }}</li>
        </ul>
      </div>
      
      <div *ngIf="reportResult.errorDetails?.warnings?.length" class="mb-3">
        <h5 class="text-yellow-700 font-medium text-sm mb-1">Warnings:</h5>
        <ul class="list-disc list-inside text-yellow-600 text-xs space-y-1">
          <li *ngFor="let warning of reportResult.errorDetails.warnings">{{ warning }}</li>
        </ul>
      </div>
      
      <div *ngIf="reportResult.errorDetails?.suggestedFilename" class="mb-3">
        <p class="text-red-700 text-sm">
          <strong>Suggested filename:</strong> 
          <code class="bg-red-100 px-1 rounded text-red-800">{{ reportResult.errorDetails.suggestedFilename }}</code>
        </p>
      </div>
      
      <div *ngIf="reportResult.accessibilityGuidance" class="bg-blue-50 border border-blue-200 rounded p-3 mt-3">
        <h5 class="text-blue-800 font-medium text-sm mb-2">ðŸ“‹ Accessibility Guidelines</h5>
        <p class="text-blue-700 text-xs mb-2">
          <strong>Section 508:</strong> {{ reportResult.accessibilityGuidance.section508 }}
        </p>
        <p class="text-blue-700 text-xs mb-2">
          <strong>WebAIM:</strong> {{ reportResult.accessibilityGuidance.webAIM }}
        </p>
        <div *ngIf="reportResult.accessibilityGuidance.recommendations?.length">
          <p class="text-blue-700 text-xs font-medium mb-1">Recommendations:</p>
          <ul class="list-disc list-inside text-blue-600 text-xs space-y-1">
            <li *ngFor="let rec of reportResult.accessibilityGuidance.recommendations">{{ rec }}</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Other Backend Validation Errors -->
    <div *ngIf="reportResult.isError && !reportResult.isFilenameError && reportResult.backendValidation" 
         class="mb-4 p-4 bg-red-50 border border-red-200 rounded">
      <h4 class="text-red-800 font-medium mb-2">ðŸš« {{ reportResult.apiMessage }}</h4>
      <p class="text-red-700 text-sm">{{ reportResult.errorDetails }}</p>
      <p *ngIf="reportResult.accessibilityNote" class="text-blue-700 text-xs mt-2">
        <strong>Note:</strong> {{ reportResult.accessibilityNote }}
      </p>
    </div>

    <!-- Summary (only show if not a validation error) -->
    <div *ngIf="!reportResult.isError && reportResult.summary" class="text-sm text-gray-700 dark:text-gray-300 mb-4">
      <p><strong>Success:</strong> {{ reportResult.summary.successCount }}</p>
      <p><strong>Failed:</strong> {{ reportResult.summary.failedCount }}</p>
      <p>
        <strong>Needs manual check:</strong>
        {{ reportResult.summary.manualCheckCount }}
      </p>
    </div>

    <!-- Failures (only show if not a validation error) -->
    <div *ngIf="!reportResult.isError && reportResult.failures?.length">
      <h4 class="font-medium text-red-600 mb-1">Failures</h4>
      <ul
        class="list-disc list-inside text-sm text-gray-700 dark:text-gray-300"
      >
        <li *ngFor="let fail of reportResult.failures">
          <strong>{{ fail.Rule }}</strong> - {{ fail.Description }}
        </li>
      </ul>
    </div>

    <!-- Manual Checks (only show if not a validation error) -->
    <div *ngIf="!reportResult.isError && reportResult.needsManualCheck?.length" class="mt-4">
      <h4 class="font-medium text-yellow-600 mb-1">Needs Manual Check</h4>
      <ul
        class="list-disc list-inside text-sm text-gray-700 dark:text-gray-300"
      >
        <li *ngFor="let item of reportResult.needsManualCheck">
          <strong>{{ item.Rule }}</strong> - {{ item.Description }}
        </li>
      </ul>
    </div>
  </div>
</div>